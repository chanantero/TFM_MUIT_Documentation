\section{Theoretical Modelling of lab scenario}
As expressed in \refeq{transEqMatrix}, the relation between the transmitted and received signals is:

\begin{gather}
\vec{c_\mathit{micro}} = \myMatrix{A} \vec{c_\mathit{louds}} \\
\vec{c_\mathit{louds}} = 
\begin{bmatrix}
	\vec{c_\mathit{WFS}} \\
	\vec{c_\mathit{NS}}
\end{bmatrix}
\label{transEqMatrixRep1}
\end{gather}

Matrix $\myMatrix{A}$ can be calculated from theoretical parameters or from experimental results. The first case was already expressed in \refeq{acPathTheoric}:

\begin{gather}
a_{m,l} = \alpha_l D_{loud (l)}(\vec{r}_{loud (l)}, \vec{r}_{micro (m)}) G(\vec{r}_{loud (l)}, \vec{r}_{micro (m)}) D_{micro (m)}(\vec{r}_{loud (l)}, \vec{r}_{micro (m)}) \beta_m 
\label{acPathTheoricRep1} \\
\vec{r_\mathit{loud}} =
\begin{bmatrix}
	\vec{r_\mathit{WFS}} \\
	\vec{r_\mathit{NS}}
\end{bmatrix}
\quad
\vec{D_\mathit{loud}} =
\begin{bmatrix}
	\vec{D_\mathit{WFS}} \\
	\vec{D_\mathit{NS}}
\end{bmatrix} 
\quad
\vec{\alpha} =
\begin{bmatrix}
	\vec{\alpha_\mathit{WFS}} \\
	\vec{\alpha_\mathit{NS}}
\end{bmatrix}
\label{WFSandNSconcatenation}
\end{gather}

The second case is:
\begin{equation}
a_{m, l} = \frac{c_{\mathit{micro} (m)}}{c_{\mathit{loud} (l)}}
\end{equation}

We are interested in cancellation, this is, in reducing the magnitude of received signals $\vec{c_\mathit{micro}}$. That must be achieved through the manipulation of transmitted signals by the WFS array $\vec{c_\mathit{WFS}}$. There are two main ways of doing this.

The first one is using WFS (section \ref{WFScalculation}). Simplifying Kirchhoff's integral to fit the scenario that is presented in the lab (a finite number of discrete sources distributed as an octagon in a particular plane), some equations are deduced (\refeq{WFScalcEq} and \refeq{WFScalcEqDelay}). They use some of the theoretical parameters (position and coefficient of the virtual noise source, position and orientation of the loudspeakers used for WFS) to calculate the transmitted coefficients of the solution. If loudspeakers can be modelled as monopoles and we assume free-space conditions, we will achieve cancellation over the whole area.

However, the real scenario is not ideal. The coefficients calculated with the previous method don't always produce a good enough cancellation when the acoustic paths are not the ideal ones. Then, some form of numerical optimisation can be useful.

In order to perform the optimisation, we've followed the usual concept of defining an objective function that returns a number depending on some of inputs, and then finding the inputs that minimize the function.

\begin{equation}
[x_{\mathit{opt} (1)}, x_{\mathit{opt} (1)}, ..., x_{\mathit{opt} (N)}] = \argmin_{x_1, x_2, ..., x_N} f(x_1, x_2, ..., x_N)
\label{optimisationGeneral}
\end{equation}

A simple and useful objective function is the norm of the vector of received signal coefficients $\norm{\vec{c_\mathit{micro}}}$. The optimization is then:
\begin{gather}
\vec{c_{\mathit{WFS}, \mathit{opt}}} =
\argmin_{\vec{c_\mathit{WFS}}}
\norm{\vec{c_\mathit{micro}}} =
\argmin_{\vec{c_\mathit{WFS}}}
\norm{\myMatrix{A}
\begin{bmatrix}
\vec{c_\mathit{WFS}}\\
\vec{c_\mathit{NS}}\\
\end{bmatrix}
} \\
\left | \vec{c_{\mathit{WFS}}} \right | <= 1
\label{OptConstraint}
\end{gather}


The solution could easily be calculated by solving the overdetermined linear system. However, the constraint (\refeq{OptConstraint}) forces us to use some form of numeric non-linear optimisation. In this case, we used the interior point algorithm. The constraint is necessary since a digital signal that exceeds an amplitude of $1$ would produce saturation.

It should be noted that, while the equations derivated from Kirchhoff's integral are intended to produce cancellation over the whole area, the optimisation is applied only to a finite number of discrete points. So, the election of those points will affect the final result.

This solution doesn't take in account any physical knowledge of the scenario, nor the WFS techniques. It's just a solution to a system of linear equations. A half way approach to this, is to minimise the same parameter $\norm{\vec{c_\mathit{micro}}}$, but not changing the transmitted coefficients $\vec{c_{\mathit{WFS}}}$ directly. Instead, we apply the constraint that they must be generated by the WFS calculation that we talked about previously. In other words, we find the virtual noise source parameters that would produce the greatest cancellation for a finite set of points. This can be useful to compare how much the real scenario can be approximated by an ideal one.

\begin{equation}
\vec{c_{\mathit{WFS}, \mathit{opt}}} =
\argmin_{\vec{c_\mathit{NS}^v}, \vec{r_{\mathit{NS}}^v}}
\norm{\myMatrix{A}
	\begin{bmatrix}
	\vec{c_\mathit{WFS}}(\vec{c_\mathit{NS}^v}, \vec{r_{\mathit{NS}}^v})\\
	\vec{c_\mathit{NS}}\\
	\end{bmatrix}
} =
\argmin_{\vec{c_\mathit{NS}^v}, \vec{r_{\mathit{NS}}^v}}
\norm{\myMatrix{A}
	\begin{bmatrix}
	\mathit{WFS}(\vec{c_\mathit{NS}^v}, \vec{r_{\mathit{NS}}^v}, \vec{r}_\mathit{WFS}, \vec{o}_\mathit{WFS})\\
	\vec{c_\mathit{NS}}\\
	\end{bmatrix}
}
\end{equation}
