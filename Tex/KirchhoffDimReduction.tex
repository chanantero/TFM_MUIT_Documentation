\chapter{2.5D Kirchhoff integral}
From three-dimensional wave equation and Green's Theorem, the Kirchhoff-Helmholtz Integral is deduced \cite{BerkhoutSeismic} \cite{Verheijen}:
\begin{equation}
P(\PosTheo) = \frac{1}{4\pi} \int_{S} \left(P(\PosTheo[surface])\frac{\partial G(\PosTheo[surface]\vert \PosTheo)}{\partial \mathbf{n}} - G(\PosTheo[surface]\vert \PosTheo) \frac{\partial P(\PosTheo[surface])}{\partial \mathbf{n}} \right) dS
\label{KirchhoffHelmholtz}
\end{equation}

It expresses the pressure field $P(\vec{x_0})$ (particularized for a given frequency) inside a free-source volume $V$ bounded by the surface $S$, as a function of the pressure at $S$, and its directional derivative in the direction of $\vec{n}$, which is the inward pointing normal vector of $S$. $G(\PosTheo \vert \PosTheo_0)$ is called Green's function, and should obey the inhomogeneous wave equation for a source at position $\PosTheo_0$ ($\Delta G - k^2 G = -4\pi\delta(\PosTheo - \PosTheo_0)$).

The general form of $G(\PosTheo \vert \PosTheo_0)$ is:
\begin{equation}
G(\PosTheo \vert \PosTheo_0) = \GreenFunc[\PosTheo - \PosTheo_0] + F(\PosTheo \vert \PosTheo_0)
\label{GreensFunction}
\end{equation}
where $F(\PosTheo \vert \PosTheo_0)$ is any function that satisfies the Helmholtz equation $\Delta F - k^2 F = 0$.

If $F = 0$:
\begin{equation}
P(\PosTheo) = \frac{1}{4\pi} \int_{S} \left(P(\PosTheo[surface]) G(\PosTheo[surface] \vert \PosTheo)\left(jk + \frac{1}{\norm{\PosTheo - \PosTheo[surface]}}\right)\cos\normSecondPropAngle - G(\PosTheo[surface] \vert \PosTheo) \frac{\partial P(\PosTheo[surface])}{\partial \mathbf{n}} \right) dS
\end{equation}
where $\normSecondPropAngle = \left\langle \frac{\PosTheo - \PosTheo[surface]}{\norm{\PosTheo - \PosTheo[surface]}} , \vec{n} \right\rangle$ is the angle between the inward normal vector and the vector that passes through the point at the surface $\PosTheo[surface]$ and $\PosTheo$.

It can be interpreted as if the field inside $V$ was the result of the field generated by infinitesimal sources distributed over $S$. The first term of the integral represents a dipole source distribution driven by the pressure at the surface. The dipoles have the inward normal vector as broadside direction. The second term of the integral represents a monopole source distribution driven by the directional derivative of the pressure at the surface. The result of the integral outside $V$ is $0$. The original sources that generate the field are called primary sources. The surface monopole and dipole source distributions that can emulate the field inside the volume will be called secondary sources.

For practical reasons, it is convenient to reduce the surface $S$ to a closed line $L$ on a plane, that would correctly synthesize the field on that plane, as it is proposed in \cite{Vogel} and developed in \cite{Start1997} and, only for the Rayleigh integrals, in \cite{Verheijen}. The way to do it is the next.

Let's assume that all primary sources and the positions where we want to synthesize their field are all located in the same plane, for example, and without loss of generalization, $y = 0$. This means that $\PosTheo = [x, 0, z],\quad z > 0$ and $\PosTheo[primarySource] = [x_\mathit{ps}, 0, z_\mathit{ps}], \quad z_\mathit{ps} < 0$.

We also assume that surface $S$ is like a tube infinitely long in the $\hat{\vec{y}}$ direction. Its section, $S_0$, is a closed 2D curve, resulting from the intersection of $S$ and the plane $y=0$. Other ways of expressing it is that the projection of $S$ onto $y=0$ is equal to their intersection, that $S$ can be built by the extension of $S_0$ along the vertical direction ($\hat{vec{y}}$), or that at each point of $S_0$, a vertical line is extended.

A given point of $S$ (let's call it $\PosTheo[surface]$) is the result of adding a height $y$ to a point of $S_0$ ($\PosTheo[section]$), which is actually the projection of $\PosTheo[surface]$ onto $y=0$ ($\PosTheo[section] = \vectorproj[y=0]{\PosTheo[surface]}$)
\begin{equation}
\PosTheo[surface] = \PosTheo[section] + y\hat{\vec{y}}
\end{equation}

In order to perform the dimensionality reduction, we calculate the contribution of each of the vertical lines that form $S$ (one for each $\PosTheo[section]$).

\begin{gather}
	P(\PosTheo) = \frac{1}{4\pi} \int_{S_0} \left( I_{1}(\PosTheo[section]) + I_2(\PosTheo[section]) \right)
	d\PosTheo[section] \\
	I_{1}(\PosTheo[section]) = - \int_{-\infty}^{\infty} G(\PosTheo[section] + y \vert \PosTheo) \frac{\partial P(\PosTheo[section] + y)}{\partial \mathbf{n}} dy \label{lineIntI} \\	I_{2}(\PosTheo[section]) = \int_{-\infty}^{\infty} P(\PosTheo[section] + y)\frac{\partial G(\PosTheo[section] + y\vert \PosTheo)}{\partial \mathbf{n}} dy \label{lineIntII}
\end{gather}

The far field approximation of the field is:
\begin{equation}
P = S(\omega) D(\varphi, \theta, \omega) \GreenFunc[{\PosTheo - \PosTheo[primarySource]}]
\end{equation}

where
\begin{gather}
	\frac{\PosTheo - \PosTheo[surface]}{\norm{\PosTheo - \PosTheo[surface]}} = [\cos{\elevation} \sin\azimuth, \sin\elevation, \cos\elevation \cos\azimuth]^T \\
	\azimuth = \arctan \frac{x - x_{\PosTheoSubInd[primarySource]}}{z - z_{\PosTheoSubInd[primarySource]}} \qquad \elevation = \arctan{\frac{y - y_{\PosTheoSubInd[primarySource]}}{\sqrt{(x - x_{\PosTheoSubInd[primarySource]})^2 + (z - z_{\PosTheoSubInd[primarySource]})^2}}} 
\end{gather}

Then,
\begin{equation}
\frac{\partial P(\PosTheo)}{\partial \mathbf{n}} = \langle \nabla P(\PosTheo), \vec{n} \rangle
\end{equation}
\begin{multline}
\nabla P(\PosTheo) = \frac{\partial P(\PosTheo)}{\partial x} \hat{\vec{x}} + \frac{\partial P(\PosTheo)}{\partial y} \hat{\vec{y}} + \frac{\partial P(\PosTheo)}{\partial z} \hat{\vec{z}} =
\left\{ \begin{matrix}
\nabla \azimuth = \frac{\cos\azimuth}{\norm{\PosTheo - \PosTheo[primarySource]} \cos \elevation} \hat{\vec{x}} +
\frac{-\sin \azimuth}{\norm{\PosTheo - \PosTheo[primarySource]} \cos \elevation} \hat{\vec{z}} \\
\nabla \elevation = \frac{-\sin \elevation \sin \azimuth}{\norm{\PosTheo - \PosTheo[primarySource]}} \hat{\vec{x}} + \frac{\cos \elevation}{\norm{\PosTheo - \PosTheo[primarySource]}} \hat{\vec{y}} + \frac{-\sin \elevation \cos \azimuth}{\norm{\PosTheo - \PosTheo[primarySource]}} \hat{\vec{z}}
\end{matrix} \right\}
= S(\omega) \GreenFunc[{\PosTheo - \PosTheo[primarySource]}]
\\ \left(D(\azimuth, \elevation, \omega)
\left(-jk - \frac{1}{\norm{\PosTheo - \PosTheo[primarySource]}}\right) \frac{\PosTheo - \PosTheo[primarySource]}{\norm{\PosTheo - \PosTheo[primarySource]}} +
\frac{\partial D}{\partial \azimuth} \frac{\cos \azimuth \hat{\vec{x}} - \sin \azimuth \hat{\vec{z}}}{\norm{\PosTheo - \PosTheo[primarySource]} \cos \elevation} + \frac{\partial D}{\partial \elevation} \frac{-\sin\elevation \sin\azimuth \hat{\vec{x}} + \cos\elevation \hat{\vec{y}} - \sin\elevation \cos\azimuth \hat{\vec{z}}}{\norm{\PosTheo - \PosTheo[primarySource]}} \right)
\end{multline}

Along a given vertical line ($\PosTheo[section] + y$), the unitary inward normal pointing vector is:
\begin{equation}
\vec{n} = [n_x, 0, n_z]^T = [\sin\azimuthNormal, 0, \cos\azimuthNormal]
\end{equation}
which remains constant and its component in $\hat{\vec{y}} = 0$.

Hence,
\begin{multline}
\frac{\partial P(\PosTheo[surface])}{\partial \mathbf{n}} = \langle \nabla P(\PosTheo[surface]), \vec{n} \rangle = \left\{
\begin{matrix}
	\cos\alpha \sin\beta - \sin\alpha \sin\beta = sin(\beta - \alpha) \\ \cos\alpha \cos\beta + \sin\alpha\sin\beta = \cos(\beta - \alpha)
\end{matrix}  \right\}
= S(\omega) \GreenFunc[{\PosTheo[surface] - \PosTheo[primarySource]}] \\ \left[ D(\azimuth, \elevation, \omega) \left(-jk - \frac{1}{\norm{\PosTheo[surface] - \PosTheo[primarySource]}}\right) \cos\elevation \cos\normPrimaryPropAngleSection + \frac{\partial D}{\partial \azimuth} \frac{\sin \normPrimaryPropAngleSection}{\norm{\PosTheo[surface] - \PosTheo[primarySource]} \cos \elevation} + \frac{\partial D}{\partial \elevation} \frac{-\sin\elevation \cos\normPrimaryPropAngleSection}{\norm{\PosTheo[surface] - \PosTheo[primarySource]}}  \right]
\label{directDerivField}
\end{multline}
where $\normPrimaryPropAngleSection = \azimuthNormal - \azimuth$.

According to the stationary phase point method,
\begin{equation}
	I = \int_{-\infty}^{+\infty} f(y) e^{j\phi(y)} dy \approx f(y_0) e^{j\phi(y_0)} \sqrt{\frac{j 2\pi}{\phi''(y_0)}}
\end{equation}
where $y_0$ is the value of $y$ where the phase gets stationary $\frac{d\phi(y)}{dy} = 0$, and $\phi''(y_0)$ is the second derivative of $\phi$ evaluated at $y_0$. Intuitively it means that the integral of a phase changing function only has a significant contribution in the region where the phase change slows down.

Substituting \autoref{directDerivField} in \autoref{lineIntI}, and taking in account that $\PosTheo[surface] = \PosTheo[section] + y\hat{\vec{y}}$ and applying the stationary phase method:
\begin{align}
f(y) &= \frac{S(\omega)}{\norm{\PosTheo[surface] - \PosTheo[primarySource]} \norm{\PosTheo[surface] - \PosTheo}} \\ 
&\left[ D(\azimuth, \elevation, \omega) \left(-jk - \frac{1}{\norm{\PosTheo[surface] - \PosTheo[primarySource]}}\right) \cos\elevation \cos\normPrimaryPropAngleSection + \frac{\partial D}{\partial \azimuth} \frac{\sin\normPrimaryPropAngleSection}{\norm{\PosTheo[surface] - \PosTheo[primarySource]} \cos \elevation} + \frac{\partial D}{\partial \elevation} \frac{-\sin\elevation \cos\normPrimaryPropAngleSection}{\norm{\PosTheo[surface] - \PosTheo[primarySource]}}  \right] \nonumber \\
\phi(y) &= -k\left(\norm{\PosTheo[surface] - \PosTheo[primarySource]} + \norm{\PosTheo[surface] - \PosTheo}\right)\\
y_0 &= 0 \\
\phi(y_0) &= -k(\distLinePrimSource + \distLinePoint) \\
f(y_0) &= \left\{ \elevation(y_0) = 0 \right\} = \frac{S(\omega)}{\distLinePrimSource \distLinePoint} \left[ D(\azimuth, 0, \omega) \left(-jk - \frac{1}{\distLinePrimSource}\right) \cos\normPrimaryPropAngleSection + \frac{\partial D}{\partial \azimuth} \frac{\sin\normPrimaryPropAngleSection}{\distLinePrimSource} \right] \\
\phi''(y_0) &= \frac{d^2\phi(y)}{dy^2}\rvert_{y = y_0} = -k\frac{\distLinePrimSource + \distLinePoint}{\distLinePrimSource \distLinePoint} \\
I &\approx \frac{S(\omega)}{\distLinePrimSource \distLinePoint} \left[ D(\azimuth, 0, \omega) \left(-jk - \frac{1}{\distLinePrimSource}\right) \cos\normPrimaryPropAngleSection + \frac{\partial D}{\partial \azimuth} \frac{\sin\normPrimaryPropAngleSection}{\distLinePrimSource} \right] e^{-jk(\distLinePrimSource + \distLinePoint)} \sqrt{\frac{j 2 \pi}{-k\frac{\distLinePrimSource + \distLinePoint}{\distLinePrimSource \distLinePoint}}}
\end{align}

where $\distLinePrimSource = \norm{\PosTheo[section] - \PosTheo[primarySource]} = \sqrt{z_{\PosTheoSubInd[primarySource]}^2 + (x_{\PosTheoSubInd[surface]} - x_{\PosTheoSubInd[primarySource]})^2}$ and $\distLinePoint = \norm{\PosTheo[section] - \PosTheo} = \sqrt{z^2 + (x_{\PosTheoSubInd[surface]} - x)^2}$.

Finally, assuming $k\distLinePrimSource >> 1$:
\begin{equation}
I_1(\PosTheo[section]) \approx S(\omega) D(\azimuth, 0, \omega) \cos\normPrimaryPropAngleSection \frac{e^{-jk\distLinePrimSource}}{\sqrt{\distLinePrimSource}} \frac{e^{-jk\distLinePoint}}{\distLinePoint} \sqrt{j2\pi k} \sqrt{\frac{\distLinePoint}{\distLinePrimSource + \distLinePoint}}
\end{equation} 

The same reasoning can be applied to \autoref{lineIntII}, and the result is \cite[Equation 3.24]{Start1997}:
\begin{equation}
I_2(\PosTheo[section]) \approx S(\omega) D(\azimuth, 0, \omega) \cos\normSecondPropAngleSection \frac{e^{-jk\distLinePrimSource}}{\sqrt{\distLinePrimSource}} \frac{e^{-jk\distLinePoint}}{\distLinePoint} \sqrt{j2\pi k} \sqrt{\frac{\distLinePoint}{\distLinePrimSource + \distLinePoint}}
\end{equation}
where $\cos\normSecondPropAngleSection = \langle \frac{\PosTheo[section] - \PosTheo}{\norm{\PosTheo[section] - \PosTheo}}, \vec{n} \rangle$



